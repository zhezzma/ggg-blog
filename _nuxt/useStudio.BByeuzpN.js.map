{"version":3,"mappings":"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","names":["props","__props","previewClasses","nuxtApp","useNuxtApp","router","useRouter","open","ref","refreshing","previewReady","error","socket","closePreviewMode","useCookie","sync","data","isUpdated","onMounted","__vitePreload","syncTimeout","clearSyncTimeout","e","onUnmounted","mergeDraft","dbFiles","draftAdditions","draftDeletions","additions","deletions","mergedFiles","addition","a","file","f","key","deletion","comperable","b","StudioConfigFiles","createSingleton","fn","instance","_args","deepDelete","obj","newObj","val","deepAssign","useDefaultAppConfig","useAppConfig","defu","createDefu","value","useStudio","studioConfig","contentConfig","useRuntimeConfig","contentPathMap","apiURL","initialAppConfig","initialTokensConfig","storage","useState","_storage","queryContent","syncPreviewFiles","contentStorage","files","previewToken","keys","sources","item","syncPreviewAppConfig","appConfig","_appConfig","callWithNuxt","syncPreviewTokensConfig","tokensConfig","themeSheet","_d","_c","_b","_a","syncPreview","contentFiles","requestRerender","requestPreviewSynchronization","mountPreviewUI","el","createApp","ContentPreviewMode","findContentWithId","path","content","updateContent","removeContentWithId","nonDraftContent","pages","useContentState","contents","acc","index","initiateIframeCommunication","route","useRoute","editorSelectedPath","routePayload","route2","toRaw","origin","type","payload","detectRenderedContents","page","renderedContents","contentIds"],"ignoreList":[0,1,2,3],"sources":["../../../../node_modules/@nuxthq/studio/dist/runtime/components/ContentPreviewMode.vue","../../../../node_modules/@nuxthq/studio/dist/runtime/utils/files.mjs","../../../../node_modules/@nuxthq/studio/dist/runtime/utils/index.mjs","../../../../node_modules/@nuxthq/studio/dist/runtime/composables/useStudio.mjs"],"sourcesContent":["<script setup lang=\"ts\">\nimport { onMounted, ref, onUnmounted, Transition } from 'vue'\nimport type { Socket } from 'socket.io-client'\nimport { useCookie, useRoute, useNuxtApp, useRouter } from '#app'\nimport type { PreviewResponse } from '../types'\n\nconst props = defineProps({\n  previewToken: {\n    type: String,\n    required: true\n  },\n  apiURL: {\n    type: String,\n    required: true\n  },\n  syncPreview: {\n    type: Function,\n    required: true\n  },\n  requestPreviewSyncAPI: {\n    type: Function,\n    required: true\n  }\n})\n\nconst previewClasses = ['__nuxt_preview', '__preview_enabled']\n\nconst nuxtApp = useNuxtApp()\nconst router = useRouter()\nconst open = ref(true)\nconst refreshing = ref(false)\nconst previewReady = ref(false)\nconst error = ref('')\nlet socket: Socket\n\nconst closePreviewMode = async () => {\n  // Remove preview token from cookie and session storage\n  useCookie('previewToken').value = ''\n  window.sessionStorage.removeItem('previewToken')\n  window.sessionStorage.removeItem('previewAPI')\n\n  // Remove query params in url to refresh page\n  await router.replace({ query: { preview: undefined } })\n\n  // Reload page to fully exit preview mode\n  window.location.reload()\n}\n\nconst sync = async (data: PreviewResponse) => {\n  const isUpdated = await props.syncPreview(data)\n\n  if (previewReady.value === true) {\n    // Preview already ready, no need to sync again\n    return\n  }\n\n  // If data is not updated, it means the storage is not ready yet and we should try again\n  if (!isUpdated) {\n    setTimeout(() => sync(data), 1000)\n    return\n  }\n\n  // Ensure that preview token is set in cookie\n  // This is needed for cases that user wants to exit preview mode before preview is ready\n  if (!useCookie('previewToken').value) {\n    return\n  }\n\n  previewReady.value = true\n  // Remove query params in url to refresh page (in case of 404 with no SPA fallback)\n  await router.replace({ query: {} })\n\n  // @ts-ignore\n  nuxtApp.callHook('nuxt-studio:preview:ready')\n\n  if (window.parent && window.self !== window.parent) {\n    socket.disconnect()\n  }\n}\n\nonMounted(async () => {\n  const io = await import('socket.io-client')\n  socket = io.connect(`${props.apiURL}/preview`, {\n    transports: ['websocket', 'polling'],\n    auth: {\n      token: props.previewToken\n    }\n  })\n\n  let syncTimeout: ReturnType<typeof setTimeout> | null\n  socket.on('connect', () => {\n    syncTimeout = setTimeout(() => {\n      if (!previewReady.value) {\n        syncTimeout = setTimeout(() => {\n          error.value = 'Preview sync timed out'\n          previewReady.value = false\n        }, 30000)\n\n        socket.emit('draft:requestSync')\n      }\n    }, 30000)\n  })\n\n  const clearSyncTimeout = () => {\n    if (syncTimeout) {\n      clearTimeout(syncTimeout)\n      syncTimeout = null\n    }\n  }\n\n  // Client should receive draft:sync event on connect\n  socket.on('draft:sync', async (data) => {\n    clearSyncTimeout()\n\n    // If no data is received, it means the draft is not ready yet\n    if (!data) {\n      // Call init to request draft sync via api\n      try {\n        // Wait for draft:ready and then request sync\n        socket.once('draft:ready', () => {\n          socket.emit('draft:requestSync')\n        })\n\n        await props.requestPreviewSyncAPI()\n      } catch (e: any) {\n        clearSyncTimeout()\n\n        switch (e.response.status) {\n          case 404:\n            error.value = 'Preview draft not found'\n            previewReady.value = false\n            break\n          default:\n            error.value = 'An error occurred while syncing preview'\n            previewReady.value = false\n        }\n      }\n      return\n    }\n\n    sync(data)\n  })\n\n  socket.on('draft:unauthorized', () => {\n    clearSyncTimeout()\n    error.value = 'Unauthorized preview token'\n    previewReady.value = false\n  })\n  socket.on('disconnect', () => {\n    clearSyncTimeout()\n  })\n\n  // Adds body classes for live preview\n  document.body.classList.add(...previewClasses)\n\n  socket.on('draft:update', (data) => {\n    refreshing.value = true\n    props.syncPreview(data)\n    refreshing.value = false\n  })\n})\n\n// Also cleans up body classes on unMounted\nonUnmounted(() => {\n  document.body.classList.remove(...previewClasses)\n})\n</script>\n\n<template>\n  <div>\n    <div\n      v-if=\"open\"\n      id=\"__nuxt_preview\"\n      :class=\"{ __preview_ready: previewReady, __preview_refreshing: refreshing }\"\n    >\n      <template v-if=\"previewReady\">\n        <svg\n          viewBox=\"0 0 90 90\"\n          fill=\"none\"\n          xmlns=\"http://www.w3.org/2000/svg\"\n        >\n          <path\n            d=\"M50.0016 71.0999h29.2561c.9293.0001 1.8422-.241 2.6469-.6992.8047-.4582 1.4729-1.1173 1.9373-1.9109.4645-.7936.7088-1.6939.7083-2.6102-.0004-.9162-.2455-1.8163-.7106-2.6095L64.192 29.713c-.4644-.7934-1.1325-1.4523-1.937-1.9105-.8046-.4581-1.7173-.6993-2.6463-.6993-.9291 0-1.8418.2412-2.6463.6993-.8046.4582-1.4726 1.1171-1.937 1.9105l-5.0238 8.5861-9.8224-16.7898c-.4648-.7934-1.1332-1.4522-1.938-1.9102-.8047-.4581-1.7176-.6992-2.6468-.6992-.9292 0-1.842.2411-2.6468.6992-.8048.458-1.4731 1.1168-1.9379 1.9102L6.56062 63.2701c-.46512.7932-.71021 1.6933-.71061 2.6095-.00041.9163.24389 1.8166.70831 2.6102.46443.7936 1.1326 1.4527 1.93732 1.9109.80473.4582 1.71766.6993 2.64686.6992h18.3646c7.2763 0 12.6422-3.1516 16.3345-9.3002l8.9642-15.3081 4.8015-8.1925 14.4099 24.6083H54.8058l-4.8042 8.1925ZM29.2077 62.899l-12.8161-.0028L35.603 30.0869l9.5857 16.4047-6.418 10.9645c-2.4521 3.9894-5.2377 5.4429-9.563 5.4429Z\"\n            fill=\"currentColor\"\n          />\n        </svg>\n        <span><a\n          href=\"https://nuxt.studio\"\n          target=\"_blank\"\n          rel=\"noopener\"\n        >Nuxt Studio</a>: Preview enabled</span>\n        <button @click=\"closePreviewMode\">\n          Close\n        </button>\n      </template>\n    </div>\n    <Transition name=\"preview-loading\">\n      <div v-if=\"open && !previewReady && !error\">\n        <div id=\"__preview_background\" />\n        <div id=\"__preview_loader\">\n          <svg\n            id=\"__preview_loading_icon\"\n            width=\"32\"\n            height=\"32\"\n            viewBox=\"0 0 24 24\"\n          >\n            <path\n              fill=\"none\"\n              stroke=\"currentColor\"\n              stroke-linecap=\"round\"\n              stroke-linejoin=\"round\"\n              stroke-width=\"2\"\n              d=\"M4 4v5h.582m15.356 2A8.001 8.001 0 0 0 4.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 0 1-15.357-2m15.357 2H15\"\n            />\n          </svg>\n          <p>Initializing the preview...</p>\n          <button @click=\"closePreviewMode\">\n            Cancel\n          </button>\n        </div>\n      </div>\n    </Transition>\n    <Transition name=\"preview-loading\">\n      <div v-if=\"error\">\n        <div id=\"__preview_background\" />\n        <div id=\"__preview_loader\">\n          <p>{{ error }}</p>\n          <button @click=\"closePreviewMode\">\n            Exit preview\n          </button>\n        </div>\n      </div>\n    </Transition>\n  </div>\n</template>\n\n<style>\nbody.__preview_enabled{padding-bottom:50px}\n</style>\n\n<style scoped>\n#__nuxt_preview {\n  height: 50px;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  gap: 10px;\n  font-family: Helvetica, sans-serif;\n  font-weight: 500;\n  position: fixed;\n  bottom: -60px;\n  left: 0;\n  right: 0;\n  background: rgba(255, 255, 255, 0.3);\n  color: black;\n  backdrop-filter: blur(20px);\n  border-top: 1px #eee solid;\n  transition: bottom 0.3s ease-in-out;\n  font-size: 16px;\n  z-index: 10000;\n}\n#__nuxt_preview.__preview_ready {\n  bottom: 0;\n}\n\n#__preview_background {\n  position: fixed;\n  top: 0;\n  left: 0;\n  z-index: 9000;\n  width: 100vw;\n  height: 100vh;\n  background: rgba(255, 255, 255, 0.3);\n  backdrop-filter: blur(8px);\n}\n\n#__preview_loader {\n  position: fixed;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  gap: 8px;\n  top: 50%;\n  left: 50%;\n  transform: translate(-50%, -50%);\n  font-size: 1.4rem;\n  z-index: 9500;\n  color: black;\n  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\n}\n#__preview_loader p {\n  margin: 10px 0;\n}\n\n.dark #__preview_background,\n.dark-mode #__preview_background {\n  background: rgba(0, 0, 0, 0.3);\n}\n.dark #__preview_loader,\n.dark-mode #__preview_loader {\n  color: white;\n}\n\n.preview-loading-enter-active,\n.preview-loading-leave-active {\n  transition: opacity 0.4s;\n}\n.preview-loading-enter,\n.preview-loading-leave-to {\n  opacity: 0;\n}\n\n#__preview_loading_icon {\n  animation: spin 1s linear infinite;\n}\n\n.dark #__nuxt_preview,\n.dark-mode #__nuxt_preview {\n  background: rgba(0, 0, 0, 0.3);\n  border-top: 1px #111 solid;\n  color: white;\n}\n#__nuxt_preview svg {\n  display: inline-block;\n  width: 30px;\n  height: 30px;\n  color: black;\n}\n.dark #__nuxt_preview svg,\n.dark-mode #__nuxt_preview svg {\n  color: white;\n}\nbutton {\n  cursor: pointer;\n  border: 1px solid rgba(0, 0, 0, 0.2);\n  padding: 4px 10px;\n  border-radius: 3px;\n  background: transparent;\n  margin-left: 5px;\n  margin-right: 8px;\n  color: rgba(0, 0, 0, 0.8);\n  font-size: 14px;\n  line-height: 1rem;\n  transition: none;\n  text-align: center;\n  font-weight: normal;\n  box-shadow: none;\n  display: inline-block;\n  width: auto;\n  margin: 0;\n}\nbutton:hover {\n  color: rgba(0, 0, 0, 0.9);\n  border-color: rgba(0, 0, 0, 0.4);\n}\n.dark-mode button,\n.dark button {\n  color: lightgray;\n  border-color: rgba(255, 255, 255, 0.2)\n}\n.dark-mode button:hover,\n.dark button:hover {\n  color: white;\n  border-color: rgba(255, 255, 255, 0.4)\n}\n#__nuxt_preview button:hover,\n#__nuxt_preview button:focus {\n  background: rgba(0, 0, 0, 0.1);\n}\n#__nuxt_preview button:active {\n  background: rgba(0, 0, 0, 0.2);\n}\n.dark #__nuxt_preview button,\n.dark-mode #__nuxt_preview button {\n  border: 1px solid rgba(255, 255, 255, 0.2);\n  color: rgba(255, 255, 255, 0.8);\n}\n.dark #__nuxt_preview button:hover,\n.dark #__nuxt_preview button:hover,\n.dark-mode #__nuxt_preview button:focus,\n.dark-mode #__nuxt_preview button:focus {\n  background: rgba(255, 255, 255, 0.1);\n}\n.dark #__nuxt_preview button:active,\n.dark-mode #__nuxt_preview button:active {\n  background: rgba(255, 255, 255, 0.2);\n}\n\na {\n  font-weight: 600;\n}\n#__nuxt_preview.__preview_refreshing svg,\n#__nuxt_preview.__preview_refreshing span,\n#__nuxt_preview.__preview_refreshing button {\n  animation: nuxt_pulsate 1s ease-out;\n  animation-iteration-count: infinite;\n  opacity: 0.5;\n}\n@keyframes nuxt_pulsate {\n  0% {\n      opacity: 1;\n  }\n  50% {\n      opacity: 0.5;\n  }\n  100% {\n      opacity: 1;\n  }\n}\n\n@keyframes spin {\n  0% {\n    transform: rotate(360deg);\n  }\n  100% {\n    transform: rotate(0deg);\n  }\n}\n</style>\n","export const mergeDraft = (dbFiles = [], draftAdditions, draftDeletions) => {\n  const additions = [...draftAdditions || []];\n  const deletions = [...draftDeletions || []];\n  const mergedFiles = JSON.parse(JSON.stringify(dbFiles));\n  for (const addition of additions) {\n    if (addition.oldPath) {\n      deletions.splice(deletions.findIndex((d) => d.path === addition.oldPath), 1);\n      const oldPathExistInCache = additions.find((a) => a.path === addition.oldPath);\n      if (oldPathExistInCache) {\n        mergedFiles.push({ path: addition.path, parsed: addition.parsed });\n      } else {\n        const file = mergedFiles.find((f) => f.path === addition.oldPath);\n        if (file) {\n          file.path = addition.path;\n          if (addition.parsed) {\n            file.parsed = addition.parsed;\n          } else if (addition.pathMeta) {\n            [\"_file\", \"_path\", \"_id\", \"_locale\"].forEach((key) => {\n              file.parsed[key] = addition.pathMeta[key];\n            });\n          }\n        }\n      }\n    } else if (addition.new) {\n      mergedFiles.push({ path: addition.path, parsed: addition.parsed });\n    } else {\n      const file = mergedFiles.find((f) => f.path === addition.path);\n      if (file) {\n        Object.assign(file, { path: addition.path, parsed: addition.parsed });\n      }\n    }\n  }\n  for (const deletion of deletions) {\n    mergedFiles.splice(mergedFiles.findIndex((f) => f.path === deletion.path), 1);\n  }\n  const comperable = new Intl.Collator(void 0, { numeric: true });\n  mergedFiles.sort((a, b) => comperable.compare(a.path, b.path));\n  return mergedFiles;\n};\n","export * from \"./files.mjs\";\nexport const StudioConfigFiles = {\n  appConfig: \"app.config.ts\",\n  nuxtConfig: \"nuxt.config.ts\",\n  tokensConfig: \"tokens.config.ts\"\n};\nexport const createSingleton = (fn) => {\n  let instance;\n  return (_args) => {\n    if (!instance) {\n      instance = fn();\n    }\n    return instance;\n  };\n};\nexport function deepDelete(obj, newObj) {\n  for (const key in obj) {\n    const val = newObj[key];\n    if (!(key in newObj)) {\n      delete obj[key];\n    }\n    if (val !== null && typeof val === \"object\") {\n      deepDelete(obj[key], newObj[key]);\n    }\n  }\n}\nexport function deepAssign(obj, newObj) {\n  for (const key in newObj) {\n    const val = newObj[key];\n    if (val !== null && typeof val === \"object\") {\n      if (Array.isArray(val) && Array.isArray(obj[key])) {\n        obj[key] = val;\n      } else {\n        obj[key] = obj[key] || {};\n        deepAssign(obj[key], val);\n      }\n    } else {\n      obj[key] = val;\n    }\n  }\n}\n","import { createApp } from \"vue\";\nimport { createDefu } from \"defu\";\nimport { callWithNuxt } from \"#app\";\nimport ContentPreviewMode from \"../components/ContentPreviewMode.vue\";\nimport { createSingleton, deepAssign, deepDelete, mergeDraft, StudioConfigFiles } from \"../utils/index.mjs\";\nimport { useAppConfig, useNuxtApp, useRuntimeConfig, useState, useContentState, queryContent, ref, toRaw, useRoute, useRouter } from \"#imports\";\nconst useDefaultAppConfig = createSingleton(() => JSON.parse(JSON.stringify(useAppConfig())));\nconst defu = createDefu((obj, key, value) => {\n  if (Array.isArray(obj[key]) && Array.isArray(value)) {\n    obj[key] = value;\n    return true;\n  }\n});\nexport const useStudio = () => {\n  const nuxtApp = useNuxtApp();\n  const { studio: studioConfig, content: contentConfig } = useRuntimeConfig().public;\n  const contentPathMap = {};\n  const apiURL = window.sessionStorage.getItem(\"previewAPI\") || studioConfig?.apiURL;\n  const initialAppConfig = useDefaultAppConfig();\n  let initialTokensConfig;\n  const storage = useState(\"studio-client-db\", () => null);\n  const dbFiles = useState(\"studio-preview-db-files\", () => []);\n  if (!storage.value) {\n    nuxtApp.hook(\"content:storage\", (_storage) => {\n      storage.value = _storage;\n    });\n    queryContent(\"/non-existing-path\").findOne();\n  }\n  const syncPreviewFiles = async (contentStorage, files) => {\n    const previewToken = window.sessionStorage.getItem(\"previewToken\");\n    const keys = await contentStorage.getKeys(`${previewToken}:`);\n    await Promise.all(keys.map((key) => contentStorage.removeItem(key)));\n    const sources = new Set(files.map((file) => file.parsed._id.split(\":\").shift()));\n    await contentStorage.setItem(`${previewToken}$`, JSON.stringify({ ignoreSources: Array.from(sources) }));\n    await Promise.all(\n      files.map((item) => {\n        contentPathMap[item.parsed._path] = item.parsed;\n        return contentStorage.setItem(`${previewToken}:${item.parsed._id}`, JSON.stringify(item.parsed));\n      })\n    );\n  };\n  const syncPreviewAppConfig = (appConfig) => {\n    const _appConfig = callWithNuxt(nuxtApp, useAppConfig);\n    if (_appConfig?.ui) {\n      _appConfig.ui.icons = { ..._appConfig.ui.icons, dynamic: true };\n    }\n    deepAssign(_appConfig, defu(appConfig, initialAppConfig));\n    if (!appConfig) {\n      deepDelete(_appConfig, initialAppConfig);\n    }\n  };\n  const syncPreviewTokensConfig = (tokensConfig) => {\n    const themeSheet = nuxtApp?.vueApp?._context?.config?.globalProperties?.$pinceauTheme;\n    if (!themeSheet || !themeSheet?.updateTheme) {\n      return;\n    }\n    if (!initialTokensConfig) {\n      initialTokensConfig = JSON.parse(JSON.stringify(themeSheet?.theme.value || {}));\n    }\n    callWithNuxt(\n      nuxtApp,\n      themeSheet.updateTheme,\n      [\n        // Using `defu` to merge with initial tokens\n        // This is important to revert to default values for missing properties\n        defu(tokensConfig, initialTokensConfig)\n      ]\n    );\n  };\n  const syncPreview = async (data) => {\n    dbFiles.value = data.files = data.files || dbFiles.value || [];\n    if (!storage.value) {\n      return false;\n    }\n    const mergedFiles = mergeDraft(data.files, data.additions, data.deletions);\n    const contentFiles = mergedFiles.filter((item) => ![StudioConfigFiles.appConfig, StudioConfigFiles.nuxtConfig, StudioConfigFiles.tokensConfig].includes(item.path));\n    await syncPreviewFiles(storage.value, contentFiles);\n    const appConfig = mergedFiles.find((item) => item.path === StudioConfigFiles.appConfig);\n    syncPreviewAppConfig(appConfig?.parsed);\n    const tokensConfig = mergedFiles.find((item) => item.path === StudioConfigFiles.tokensConfig);\n    syncPreviewTokensConfig(tokensConfig?.parsed);\n    requestRerender();\n    return true;\n  };\n  const requestPreviewSynchronization = async () => {\n    const previewToken = window.sessionStorage.getItem(\"previewToken\");\n    await $fetch(\"api/projects/preview/sync\", {\n      baseURL: apiURL,\n      method: \"POST\",\n      params: {\n        token: previewToken\n      }\n    });\n  };\n  const mountPreviewUI = () => {\n    const previewToken = window.sessionStorage.getItem(\"previewToken\");\n    const el = document.createElement(\"div\");\n    el.id = \"__nuxt_preview_wrapper\";\n    document.body.appendChild(el);\n    createApp(ContentPreviewMode, {\n      previewToken,\n      apiURL,\n      syncPreview,\n      requestPreviewSyncAPI: requestPreviewSynchronization\n    }).mount(el);\n  };\n  const findContentWithId = async (path) => {\n    const previewToken = window.sessionStorage.getItem(\"previewToken\");\n    if (!path) {\n      return null;\n    }\n    path = path.replace(/\\/$/, \"\");\n    let content = await storage.value?.getItem(`${previewToken}:${path}`);\n    if (!content) {\n      content = await storage.value?.getItem(`cached:${path}`);\n    }\n    if (!content) {\n      content = content = await storage.value?.getItem(path);\n    }\n    if (!content) {\n      content = contentPathMap[path || \"/\"];\n    }\n    return content;\n  };\n  const updateContent = (content) => {\n    const previewToken = window.sessionStorage.getItem(\"previewToken\");\n    if (!storage.value) {\n      return;\n    }\n    contentPathMap[content.parsed._path] = content.parsed;\n    storage.value.setItem(`${previewToken}:${content.parsed?._id}`, JSON.stringify(content.parsed));\n  };\n  const removeContentWithId = async (path) => {\n    const previewToken = window.sessionStorage.getItem(\"previewToken\");\n    const content = await findContentWithId(path);\n    await storage.value?.removeItem(`${previewToken}:${path}`);\n    if (content) {\n      delete contentPathMap[content._path];\n      const nonDraftContent = await findContentWithId(content._id);\n      if (nonDraftContent) {\n        contentPathMap[nonDraftContent._path] = nonDraftContent;\n      }\n    }\n  };\n  const requestRerender = async () => {\n    if (contentConfig?.documentDriven) {\n      const { pages } = callWithNuxt(nuxtApp, useContentState);\n      const contents = await Promise.all(Object.keys(pages.value).map(async (key) => {\n        return await findContentWithId(pages.value[key]?._id ?? key);\n      }));\n      pages.value = contents.reduce((acc, item, index) => {\n        if (item) {\n          acc[Object.keys(pages.value)[index]] = item;\n        }\n        return acc;\n      }, {});\n    }\n    await nuxtApp.hooks.callHookParallel(\"app:data:refresh\");\n  };\n  return {\n    apiURL,\n    contentStorage: storage,\n    syncPreviewFiles,\n    syncPreviewAppConfig,\n    syncPreviewTokensConfig,\n    requestPreviewSynchronization,\n    findContentWithId,\n    updateContent,\n    removeContentWithId,\n    requestRerender,\n    mountPreviewUI,\n    initiateIframeCommunication\n  };\n  function initiateIframeCommunication() {\n    if (!window.parent || window.self === window.parent) {\n      return;\n    }\n    const router = useRouter();\n    const route = useRoute();\n    const editorSelectedPath = ref(\"\");\n    const routePayload = (route2) => ({\n      path: route2.path,\n      query: toRaw(route2.query),\n      params: toRaw(route2.params),\n      fullPath: route2.fullPath,\n      meta: toRaw(route2.meta)\n    });\n    window.addEventListener(\"keydown\", (e) => {\n      if (e.metaKey || e.ctrlKey || e.altKey || e.shiftKey) {\n        window.parent.postMessage({\n          type: \"nuxt-studio:preview:keydown\",\n          payload: {\n            key: e.key,\n            metaKey: e.metaKey,\n            ctrlKey: e.ctrlKey,\n            shiftKey: e.shiftKey,\n            altKey: e.altKey\n          }\n        }, \"*\");\n      }\n    });\n    window.addEventListener(\"message\", async (e) => {\n      const allowedOrigins = studioConfig?.iframeMessagingAllowedOrigins?.split(\",\").map((origin) => origin.trim()) || [];\n      if (![\"https://nuxt.studio\", \"https://new.nuxt.studio\", \"https://new.dev.nuxt.studio\", \"https://dev.nuxt.studio\", \"http://localhost:3000\", ...allowedOrigins].includes(e.origin)) {\n        return;\n      }\n      const { type, payload = {} } = e.data || {};\n      switch (type) {\n        case \"nuxt-studio:editor:file-selected\": {\n          const content = await findContentWithId(payload.path);\n          if (!content) {\n          } else if (content._partial) {\n          } else if (content._path !== useRoute().path) {\n            editorSelectedPath.value = content._path;\n            router.push(content._path);\n          }\n          break;\n        }\n        case \"nuxt-studio:editor:file-changed\": {\n          const { additions = [], deletions = [] } = payload;\n          for (const addition of additions) {\n            await updateContent(addition);\n          }\n          for (const deletion of deletions) {\n            await removeContentWithId(deletion.path);\n          }\n          requestRerender();\n          break;\n        }\n        case \"nuxt-studio:preview:sync\": {\n          syncPreview(payload);\n          break;\n        }\n        case \"nuxt-studio:config:file-changed\": {\n          const { additions = [], deletions = [] } = payload;\n          const appConfig = additions.find((item) => item.path === StudioConfigFiles.appConfig);\n          if (appConfig) {\n            syncPreviewAppConfig(appConfig?.parsed);\n          }\n          const shouldRemoveAppConfig = deletions.find((item) => item.path === StudioConfigFiles.appConfig);\n          if (shouldRemoveAppConfig) {\n            syncPreviewAppConfig(void 0);\n          }\n          const tokensConfig = additions.find((item) => item.path === StudioConfigFiles.tokensConfig);\n          if (tokensConfig) {\n            syncPreviewTokensConfig(tokensConfig?.parsed);\n          }\n          const shouldRemoveTokensConfig = deletions.find((item) => item.path === StudioConfigFiles.tokensConfig);\n          if (shouldRemoveTokensConfig) {\n            syncPreviewTokensConfig(void 0);\n          }\n          break;\n        }\n      }\n    });\n    nuxtApp.hook(\"page:finish\", () => {\n      detectRenderedContents();\n      if (nuxtApp.payload.prerenderedAt) {\n        requestRerender();\n      }\n    });\n    nuxtApp.hook(\"content:document-driven:finish\", ({ route: route2, page }) => {\n      route2.meta.studio_page_contentId = page?._id;\n    });\n    nuxtApp.hook(\"nuxt-studio:preview:ready\", () => {\n      window.parent.postMessage({\n        type: \"nuxt-studio:preview:ready\",\n        payload: routePayload(useRoute())\n      }, \"*\");\n      setTimeout(() => {\n        detectRenderedContents();\n      }, 100);\n    });\n    function detectRenderedContents() {\n      const renderedContents = Array.from(window.document.querySelectorAll(\"[data-content-id]\")).map((el) => el.getAttribute(\"data-content-id\"));\n      const contentIds = Array.from(/* @__PURE__ */ new Set([route.meta.studio_page_contentId, ...renderedContents])).filter(Boolean);\n      if (editorSelectedPath.value === contentIds[0]) {\n        editorSelectedPath.value = \"\";\n        return;\n      }\n      window.openContentInStudioEditor(contentIds, { navigate: true, pageContentId: route.meta.studio_page_contentId });\n    }\n    window.openContentInStudioEditor = (contentIds, data = {}) => {\n      window.parent.postMessage({\n        type: \"nuxt-studio:preview:navigate\",\n        payload: {\n          ...routePayload(route),\n          contentIds,\n          ...data\n        }\n      }, \"*\");\n    };\n  }\n};\n"],"file":"_nuxt/useStudio.BByeuzpN.js"}