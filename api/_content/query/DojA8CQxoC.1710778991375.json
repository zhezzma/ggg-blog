{"_path":"/game/2021-06-12-edgar-code-read","_dir":"game","_draft":false,"_partial":false,"_locale":"","title":"Edgar源代码解读","description":"生成类LevelGeneratorBase  最基本的生成方法类包括Generate和GenerateCoroutineDungeonGeneratorBase 一般都会继承于该类Generate流程创建playload,即IPipelineTask的上下文创建pipelineTask,包括三个InputTask,GeneratorTask,PostProcessingTaskPipelineRunner执行管道任务,将playload赋值给各个pipelineTask然后执行pipelinetask的Process()函数pipelineTask你可以继承LevelGeneratorBase","body":{"type":"root","children":[{"type":"element","tag":"h3","props":{"id":"生成类"},"children":[{"type":"text","value":"生成类"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"LevelGeneratorBase"}]},{"type":"text","value":"  最基本的生成方法类包括"},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"Generate"}]},{"type":"text","value":"和"},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"GenerateCoroutine"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"DungeonGeneratorBase"}]},{"type":"text","value":" 一般都会继承于该类"}]}]},{"type":"element","tag":"h4","props":{"id":"generate流程"},"children":[{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"Generate"}]},{"type":"text","value":"流程"}]},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"创建playload,即IPipelineTask的上下文"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"创建pipelineTask,包括三个"},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"InputTask"}]},{"type":"text","value":","},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"GeneratorTask"}]},{"type":"text","value":","},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"PostProcessingTask"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"PipelineRunner执行管道任务,将playload赋值给各个pipelineTask然后执行pipelinetask的"},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"Process()"}]},{"type":"text","value":"函数"}]}]},{"type":"element","tag":"h4","props":{"id":"pipelinetask"},"children":[{"type":"text","value":"pipelineTask"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"你可以继承"},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"LevelGeneratorBase"}]},{"type":"text","value":"  然后分别覆盖"},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"GetInputTask()"}]},{"type":"text","value":"和"},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"GetGeneratorTask()"}]},{"type":"text","value":",还有"},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"GetPostProcessingTask()"}]}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"InputTask"}]},{"type":"text","value":"   一般来说是FixedLevelGraphInputTask,主要是用来设置Payload.LevelDescription"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"GeneratorTask"}]},{"type":"text","value":"   主要是通过GraphBasedGeneratorGrid2D来设置Payload.GeneratedLevel 和 Payload.GeneratorStats,还有会实例化"},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"Generated Level/Room template instances"}]},{"type":"text","value":"以及下面的房间,参见"},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"GeneratorUtils.TransformLayout"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"PostProcessingTask"}]},{"type":"text","value":"  主要是根据PriorityCallbacks按照优先顺序执行回调函数,默认的回调函数,通过配置有以下"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"InitializeSharedTilemaps 即实例化"},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"GeneratedLevel/Tilemaps"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"CopyTilesToSharedTilemaps 将rooms下的tile复制到SharedTilemaps 下"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"CenterGrid 将Generated Level下的子对象设置为0,0"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"DisableRoomTemplatesRenderers    禁用roomtemapltes下的显示"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"DisableRoomTemplatesColliders  禁用roomtemplates下的碰撞"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"还可以通过继承DungeonGeneratorPostProcessBase写你自己的后处理函数"}]}]}]}]},{"type":"element","tag":"h3","props":{"id":"door-sockets"},"children":[{"type":"text","value":"Door sockets"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"门锁..就是走廊和房间选中同一个锁,就能匹配的上"}]},{"type":"element","tag":"h2","props":{"id":"对于连接处"},"children":[{"type":"text","value":"对于连接处"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"他会按照顺序copy到sharedtilemaps.所以,位于连接处的tile,如果后面的会覆盖前面的"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"image-20210630183742467","src":"/images/2021-06-12-edgar-code-read/image-20210630183742467.png"},"children":[]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"image-20210630183825008","src":"/images/2021-06-12-edgar-code-read/image-20210630183825008.png"},"children":[]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"最终的合成则是下图"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"image-20210630183914172","src":"/images/2021-06-12-edgar-code-read/image-20210630183914172.png"},"children":[]}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"生成类","depth":3,"text":"生成类"},{"id":"door-sockets","depth":3,"text":"Door sockets"},{"id":"对于连接处","depth":2,"text":"对于连接处"}]}},"_type":"markdown","_id":"content:game:2021-06-12-edgar-code-read.md","_source":"content","_file":"game/2021-06-12-edgar-code-read.md","_extension":"md","date":"2021-06-12"}