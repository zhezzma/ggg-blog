{"_path":"/unity/2021-05-20-ecs-commandbuff-question","_dir":"unity","_draft":false,"_partial":false,"_locale":"","title":"commandbuff的一些问题","description":"componentpublic struct State:IComponentData\n{\n    public int a;\n} \na系统\n var PostUpdateCommands = World.GetExistingSystem<AbilityUpdateCommandBufferSystem>().CreateCommandBuffer();\nEntities\n    .ForEach((Entity entity) =>\n    {\n        var state = EntityManager.GetComponent<State>(entity);\n        st","body":{"type":"root","children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"component"}]},{"type":"element","tag":"pre","props":{"code":"public struct State:IComponentData\n{\n    public int a;\n} \n"},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"public struct State:IComponentData\n{\n    public int a;\n} \n"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"a系统"}]},{"type":"element","tag":"pre","props":{"code":"\n var PostUpdateCommands = World.GetExistingSystem<AbilityUpdateCommandBufferSystem>().CreateCommandBuffer();\nEntities\n    .ForEach((Entity entity) =>\n    {\n        var state = EntityManager.GetComponent<State>(entity);\n        state.a = 1111;\n        PostUpdateCommands.SetComponent(entity,state);\n    })\n    .WithoutBurst()\n    .Run();\n"},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"\n var PostUpdateCommands = World.GetExistingSystem<AbilityUpdateCommandBufferSystem>().CreateCommandBuffer();\nEntities\n    .ForEach((Entity entity) =>\n    {\n        var state = EntityManager.GetComponent<State>(entity);\n        state.a = 1111;\n        PostUpdateCommands.SetComponent(entity,state);\n    })\n    .WithoutBurst()\n    .Run();\n"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"b系统"}]},{"type":"element","tag":"pre","props":{"code":"Entities\n    .ForEach((Entity entity) =>\n    {\n        var state = EntityManager.GetComponent<State>(entity);\n        state.a = 2222;\n        EntityManager.SetComponentData(entity,state);\n    })\n     .WithStructuralChanges()\n    .Run();\n"},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"Entities\n    .ForEach((Entity entity) =>\n    {\n        var state = EntityManager.GetComponent<State>(entity);\n        state.a = 2222;\n        EntityManager.SetComponentData(entity,state);\n    })\n     .WithStructuralChanges()\n    .Run();\n"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"执行顺序"}]},{"type":"element","tag":"pre","props":{"code":"A-->B-->AbilityUpdateCommandBufferSystem\n"},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"A-->B-->AbilityUpdateCommandBufferSystem\n"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"这里的结果,我们以为是2222.其实是1111."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"所以要么全是使用commandbuff.否则容易造成数据错误"}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[]}},"_type":"markdown","_id":"content:unity:2021-05-20-ecs-commandbuff-question.md","_source":"content","_file":"unity/2021-05-20-ecs-commandbuff-question.md","_extension":"md","date":"2021-05-20"}