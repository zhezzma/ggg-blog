{"_path":"/dotnet/2019-06-05-linux-dotnet-daemon","_dir":"dotnet","_draft":false,"_partial":false,"_locale":"","title":"Linux部署dotnetcore记录","description":"DaemonLinux Daemon（守护进程）是运行在后台的一种特殊进程。它独立于控制终端并且周期性地执行某种任务或等待处理某些发生的事件。它不需要用户输入就能运行而且提供某种服务，不是对整个系统就是对某个用户程序提供服务。Linux系统的大多数服务器就是通过守护进程实现的。常见的守护进程包括系统日志进程syslogd、 web服务器httpd、邮件服务器sendmail和数据库服务器mysqld等...配置文件sudo vi /etc/systemd/system/KestrelDemoSer.service\n修改配置[Unit]\nDescription=KestrelDemo runni","body":{"type":"root","children":[{"type":"element","tag":"h2","props":{"id":"daemon"},"children":[{"type":"text","value":"Daemon"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Linux Daemon（守护进程）是运行在后台的一种特殊进程。它独立于控制终端并且周期性地执行某种任务或等待处理某些发生的事件。它不需要用户输入就能运行而且提供某种服务，不是对整个系统就是对某个用户程序提供服务。Linux系统的大多数服务器就是通过守护进程实现的。常见的守护进程包括系统日志进程syslogd、 web服务器httpd、邮件服务器sendmail和数据库服务器mysqld等..."}]},{"type":"element","tag":"h3","props":{"id":"配置文件"},"children":[{"type":"text","value":"配置文件"}]},{"type":"element","tag":"pre","props":{"code":"sudo vi /etc/systemd/system/KestrelDemoSer.service\n"},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"sudo vi /etc/systemd/system/KestrelDemoSer.service\n"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"修改配置"}]},{"type":"element","tag":"pre","props":{"code":"[Unit]\nDescription=KestrelDemo running on CentOS\n[Service]\nWorkingDirectory=/cusD/wwwroot/KesPublish\nType=simple\nUser=root\nGroup=root\nExecStart=/usr/bin/dotnet /cusD/wwwroot/KesPublish/KestrelDemo.dll\nRestart=always\n# Restart service after 10 seconds if the dotnet service crashes:\nRestartSec=10\nSyslogIdentifier=dotnet-example\nEnvironment=ASPNETCORE_ENVIRONMENT=Production\nEnvironment=DOTNET_PRINT_TELEMETRY_MESSAGE=false\n[Install]\nWantedBy=multi-user.target\n"},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"[Unit]\nDescription=KestrelDemo running on CentOS\n[Service]\nWorkingDirectory=/cusD/wwwroot/KesPublish\nType=simple\nUser=root\nGroup=root\nExecStart=/usr/bin/dotnet /cusD/wwwroot/KesPublish/KestrelDemo.dll\nRestart=always\n# Restart service after 10 seconds if the dotnet service crashes:\nRestartSec=10\nSyslogIdentifier=dotnet-example\nEnvironment=ASPNETCORE_ENVIRONMENT=Production\nEnvironment=DOTNET_PRINT_TELEMETRY_MESSAGE=false\n[Install]\nWantedBy=multi-user.target\n"}]}]},{"type":"element","tag":"h3","props":{"id":"命令"},"children":[{"type":"text","value":"命令"}]},{"type":"element","tag":"pre","props":{"code":"systemctl enable KestrelDemoSer.service\nsystemctl start KestrelDemoSer.service\nsystemctl status KestrelDemoSer.service\nsudo journalctl -fu KestrelDemoSer.service  //查看日志\n"},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"systemctl enable KestrelDemoSer.service\nsystemctl start KestrelDemoSer.service\nsystemctl status KestrelDemoSer.service\nsudo journalctl -fu KestrelDemoSer.service  //查看日志\n"}]}]},{"type":"element","tag":"h2","props":{"id":"jenkins"},"children":[{"type":"text","value":"jenkins"}]},{"type":"element","tag":"pre","props":{"code":"sudo systemctl stop edu\nsudo dotnet publish -c Release ${WORKSPACE}/src/Edu.Web/Edu.Web.csproj -o /usr/local/src/edu\nsudo systemctl start edu\n","language":"shell","meta":"","className":["language-shell"]},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"sudo systemctl stop edu\nsudo dotnet publish -c Release ${WORKSPACE}/src/Edu.Web/Edu.Web.csproj -o /usr/local/src/edu\nsudo systemctl start edu\n"}]}]},{"type":"element","tag":"h3","props":{"id":"efcore-update"},"children":[{"type":"text","value":"efcore update"}]},{"type":"element","tag":"pre","props":{"code":"dotnet ef database update --context Edu.EntityFrameworkCore.EduMigrationsDbContext --startup-project ./src/Edu.Web/Edu.Web.csproj --project ./src/Edu.EntityFrameworkCore.DbMigrations/Edu.EntityFrameworkCore.DbMigrations.csproj   -v\n","language":"shell","meta":"","className":["language-shell"]},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"dotnet ef database update --context Edu.EntityFrameworkCore.EduMigrationsDbContext --startup-project ./src/Edu.Web/Edu.Web.csproj --project ./src/Edu.EntityFrameworkCore.DbMigrations/Edu.EntityFrameworkCore.DbMigrations.csproj   -v\n"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"不能使用sudo的解决办法"}]},{"type":"element","tag":"pre","props":{"code":"sudo visudo\n\njenkins ALL=(ALL) NOPASSWD: ALL\n\nsystemctl restart jenkins\n"},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"sudo visudo\n\njenkins ALL=(ALL) NOPASSWD: ALL\n\nsystemctl restart jenkins\n"}]}]},{"type":"element","tag":"h2","props":{"id":"mysql"},"children":[{"type":"text","value":"mysql"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"从windows迁移到linux时..mysql数据库的表明可能会有大小写敏感的问题\n修改mysql配置my.ini"}]},{"type":"element","tag":"pre","props":{"code":"lower_case_table_names = 0 //mysql会根据表名直接操作，大小写敏感。 \nlower_case_table_names = 1 //mysql会先把表名转为小写，再执行操作。 \n"},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"lower_case_table_names = 0 //mysql会根据表名直接操作，大小写敏感。 \nlower_case_table_names = 1 //mysql会先把表名转为小写，再执行操作。 \n"}]}]},{"type":"element","tag":"h1","props":{"id":"windows下绝对路径启动问题"},"children":[{"type":"text","value":"windows下绝对路径启动问题"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"注册成services后.他的启动目录是C:\\Windows\\System32..所以需要手动设置下contentRoot"}]},{"type":"element","tag":"pre","props":{"code":"F:\\DotHass.Blog\\aspnet-core\\src\\DotHass.Blog.Web\\bin\\Release\\publish\\DotHass.Blog.Web.exe --contentRoot F:\\DotHass.Blog\\aspnet-core\\src\\DotHass.Blog.Web\\bin\\Release\\publish\n"},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"F:\\DotHass.Blog\\aspnet-core\\src\\DotHass.Blog.Web\\bin\\Release\\publish\\DotHass.Blog.Web.exe --contentRoot F:\\DotHass.Blog\\aspnet-core\\src\\DotHass.Blog.Web\\bin\\Release\\publish\n"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"如果启动失败..先查看错误日志..最好是用文件存储"}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"daemon","depth":2,"text":"Daemon","children":[{"id":"配置文件","depth":3,"text":"配置文件"},{"id":"命令","depth":3,"text":"命令"}]},{"id":"jenkins","depth":2,"text":"jenkins","children":[{"id":"efcore-update","depth":3,"text":"efcore update"}]},{"id":"mysql","depth":2,"text":"mysql"}]}},"_type":"markdown","_id":"content:dotnet:2019-06-05-linux-dotnet-daemon.md","_source":"content","_file":"dotnet/2019-06-05-linux-dotnet-daemon.md","_extension":"md","date":"2019-06-05"}